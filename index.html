<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Job Scraper - Live API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0077b5 0%, #00a0dc 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .api-status {
            background: #4caf50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
            display: inline-block;
        }

        .search-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .search-form {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr auto;
            gap: 20px;
            align-items: end;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }

        .form-group input,
        .form-group select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #0077b5;
            box-shadow: 0 0 0 3px rgba(0, 119, 181, 0.1);
            outline: none;
        }

        .filters-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .search-btn {
            background: linear-gradient(135deg, #0077b5 0%, #00a0dc 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 119, 181, 0.3);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .cache-section {
            padding: 20px 30px;
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cache-info {
            font-size: 14px;
            color: #856404;
        }

        .cache-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .cache-btn:hover {
            background: #e0a800;
            transform: translateY(-1px);
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 18px;
            color: #6c757d;
        }

        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #0077b5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .results-section {
            padding: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .results-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: #495057;
        }

        .results-meta {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .export-section {
            display: flex;
            gap: 10px;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .job-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 25px;
        }

        .job-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .job-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: #0077b5;
        }

        .job-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(135deg, #0077b5 0%, #00a0dc 100%);
        }

        .job-header {
            margin-bottom: 15px;
        }

        .job-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #212529;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .job-company {
            font-size: 1.1rem;
            color: #0077b5;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .trusted-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .job-location {
            color: #6c757d;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 14px;
        }

        .job-location::before {
            content: 'üìç';
            margin-right: 5px;
        }

        .job-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .job-type,
        .job-level,
        .job-category {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .job-type {
            background: #e3f2fd;
            color: #1976d2;
        }

        .job-type.internship {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .job-type.contract {
            background: #fff3e0;
            color: #f57c00;
        }

        .job-type.part-time {
            background: #e8f5e8;
            color: #388e3c;
        }

        .job-level {
            background: #fff3e0;
            color: #e65100;
        }

        .job-category {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .job-salary {
            background: #e8f5e8;
            color: #2e7d32;
            font-weight: 700;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }

        .job-skills {
            margin-bottom: 15px;
        }

        .job-skills h4 {
            font-size: 13px;
            color: #495057;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .skill-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .skill-tag {
            background: #f8f9fa;
            color: #495057;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            border: 1px solid #dee2e6;
        }

        .job-description {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .job-description h4 {
            font-size: 13px;
            color: #495057;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .job-description p {
            font-size: 12px;
            color: #6c757d;
            line-height: 1.4;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .job-requirements {
            margin-top: 10px;
        }

        .job-requirements ul {
            font-size: 11px;
            color: #6c757d;
            margin-left: 15px;
        }

        .job-requirements li {
            margin-bottom: 2px;
        }

        .job-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6c757d;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            border-left: 4px solid #dc3545;
        }

        .analytics-section {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .analytics-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .analytics-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #0077b5;
            margin-bottom: 5px;
        }

        .analytics-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .search-form {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .filters-row {
                grid-template-columns: 1fr;
            }

            .job-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .cache-section {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîç LinkedIn Job Scraper</h1>
            <p>Enhanced scraping with intelligent caching and advanced filters</p>
            <span class="api-status" id="apiStatus">API Connected</span>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <form class="search-form" id="searchForm">
                <div class="form-group">
                    <label for="keywords">Job Keywords</label>
                    <input type="text" id="keywords" name="keywords" value=""
                        placeholder="e.g., Python Developer, Data Scientist" required>
                </div>

                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" name="location" value="" placeholder="e.g., San Francisco, CA"
                        required>
                </div>

                <div class="form-group">
                    <label for="maxJobs">Max Jobs</label>
                    <select id="maxJobs" name="maxJobs">
                        <option value="5">5 Jobs</option>
                        <option value="10" selected>10 Jobs</option>
                        <option value="25">25 Jobs</option>
                        <option value="50">50 Jobs</option>
                    </select>
                </div>

                <button type="submit" class="search-btn" id="searchBtn">
                    Search Jobs
                </button>
            </form>

            <div class="filters-row">
                <div class="form-group">
                    <label for="jobType">Job Type Filter</label>
                    <select id="jobType" name="jobType">
                        <option value="">All Types</option>
                        <option value="full-time">Full-time</option>
                        <option value="part-time">Part-time</option>
                        <option value="contract">Contract</option>
                        <option value="internship">Internship</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="category">Category Filter</label>
                    <select id="category" name="category">
                        <option value="">Loading categories...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="trustedOnly">Company Filter</label>
                    <select id="trustedOnly" name="trustedOnly">
                        <option value="true">Trusted Companies Only</option>
                        <option value="false">All Companies</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Cache Section -->
        <div class="cache-section" id="cacheSection">
            <div class="cache-info">
                <span id="cacheStatus">Loading cache status...</span>
            </div>
            <div>
                <button class="cache-btn" onclick="clearCache(true)">Clear Expired</button>
                <button class="cache-btn" onclick="clearCache(false)">Clear All</button>
                <button class="cache-btn" onclick="getCacheStatus()">Refresh Status</button>
            </div>
        </div>

        <!-- Loading Section -->
        <div id="loadingSection" class="loading" style="display: none;">
            <div class="spinner"></div>
            <div id="loadingText">Scraping LinkedIn jobs...</div>
            <div style="font-size: 14px; margin-top: 10px;">Using real LinkedIn API</div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section" style="display: none;">
            <div class="results-header">
                <div>
                    <div class="results-count" id="resultsCount">0 Jobs Found</div>
                    <div class="results-meta" id="resultsMeta"></div>
                </div>
                <div class="export-section">
                    <button class="export-btn" onclick="exportResults('json')">üìä Export JSON</button>
                    <button class="export-btn" onclick="exportResults('csv')">üìã Export CSV</button>
                </div>
            </div>
            <div class="job-grid" id="jobGrid"></div>
        </div>

        <!-- Analytics Section -->
        <div id="analyticsSection" class="analytics-section" style="display: none;">
            <h3>Job Market Analytics</h3>
            <div class="analytics-grid" id="analyticsGrid"></div>
        </div>

        <!-- No Results -->
        <div id="noResults" class="no-results" style="display: none;">
            <h3>No Jobs Found</h3>
            <p>Try different keywords or adjust your filters</p>
        </div>

        <!-- Error Section -->
        <div id="errorSection" style="display: none;">
            <div class="error-message" id="errorMessage"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let currentJobsData = [];
        let isSearching = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            loadCategories();
            getCacheStatus();
            checkAPIStatus();

            // Auto-focus on keywords input
            document.getElementById('keywords').focus();
        });

        // Search form handler
        document.getElementById('searchForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const keywords = document.getElementById('keywords').value.trim();
            const location = document.getElementById('location').value.trim();

            if (!keywords || !location) {
                showError('Please enter both keywords and location');
                return;
            }

            const maxJobs = parseInt(document.getElementById('maxJobs').value);
            const jobType = document.getElementById('jobType').value;
            const category = document.getElementById('category').value;
            const trustedOnly = document.getElementById('trustedOnly').value === 'true';

            searchJobs(keywords, location, maxJobs, jobType, category, trustedOnly);
        });

        async function checkAPIStatus() {
            try {
                const response = await fetch(`${API_BASE}/cache/status`);
                const data = await response.json();

                if (data.success) {
                    document.getElementById('apiStatus').textContent = 'API Connected';
                    document.getElementById('apiStatus').style.background = '#4caf50';
                } else {
                    throw new Error('API not responding');
                }
            } catch (error) {
                document.getElementById('apiStatus').textContent = 'API Disconnected';
                document.getElementById('apiStatus').style.background = '#f44336';
                console.error('API Status Check Failed:', error);
            }
        }

        async function loadCategories() {
            try {
                // For now, use predefined categories since we don't have the endpoint
                const categories = [
                    'All Categories',
                    'Software Engineering',
                    'Data Science & Analytics',
                    'DevOps & Infrastructure',
                    'Product & Design',
                    'Cybersecurity',
                    'Project Management',
                    'Sales & Marketing',
                    'Finance & Accounting',
                    'Human Resources',
                    'Operations'
                ];

                const categorySelect = document.getElementById('category');
                categorySelect.innerHTML = categories.map(cat =>
                    `<option value="${cat === 'All Categories' ? '' : cat}">${cat}</option>`
                ).join('');
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        async function getCacheStatus() {
            try {
                const response = await fetch(`${API_BASE}/cache/status`);
                const data = await response.json();

                if (data.success) {
                    const info = data.cache_info;
                    document.getElementById('cacheStatus').textContent =
                        `Cache: ${info.valid_files || 0} valid entries ‚Ä¢ ${info.total_jobs || 0} jobs ‚Ä¢ ${info.cache_size_mb || 0}MB`;
                } else {
                    document.getElementById('cacheStatus').textContent = 'Cache status unavailable';
                }
            } catch (error) {
                document.getElementById('cacheStatus').textContent = 'Cache status error';
                console.error('Cache status error:', error);
            }
        }

        async function clearCache(expiredOnly = true) {
            try {
                const response = await fetch(`${API_BASE}/cache/clear`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ expired_only: expiredOnly })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage(`Cache cleared: ${data.message}`, 'success');
                    getCacheStatus();
                } else {
                    throw new Error(data.error || 'Failed to clear cache');
                }
            } catch (error) {
                showError('Error clearing cache: ' + error.message);
            }
        }

        async function searchJobs(keywords, location, maxJobs, jobType = '', category = '', trustedOnly = true, forceRefresh = false) {
            if (isSearching) return;

            isSearching = true;

            // Show loading
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('analyticsSection').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
            document.getElementById('errorSection').style.display = 'none';
            document.getElementById('searchBtn').disabled = true;

            document.getElementById('loadingText').textContent = forceRefresh ?
                'Force refreshing job data...' : 'Searching LinkedIn jobs...';

            try {
                const response = await fetch(`${API_BASE}/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        keywords,
                        location,
                        max_jobs: maxJobs,
                        job_type: jobType,
                        category: category,
                        trusted_only: trustedOnly,
                        force_refresh: forceRefresh
                    })
                });

                const data = await response.json();

                if (data.success) {
                    currentJobsData = data.jobs;
                    displayResults(data.jobs);
                    displayAnalytics(data.jobs);

                    const cacheStatus = data.cached && !forceRefresh ? 'from cache' : 'live data';
                    showMessage(`Found ${data.count} jobs (${cacheStatus})`, 'success');

                    // Update cache status
                    getCacheStatus();
                } else {
                    throw new Error(data.error || 'Search failed');
                }

            } catch (error) {
                showError('Error searching jobs: ' + error.message);
                console.error('Search error:', error);
            } finally {
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('searchBtn').disabled = false;
                isSearching = false;
            }
        }

        function displayResults(jobs) {
            const resultsSection = document.getElementById('resultsSection');
            const jobGrid = document.getElementById('jobGrid');
            const resultsCount = document.getElementById('resultsCount');
            const resultsMeta = document.getElementById('resultsMeta');
            const noResults = document.getElementById('noResults');

            if (jobs.length === 0) {
                resultsSection.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            resultsCount.textContent = `${jobs.length} Job${jobs.length !== 1 ? 's' : ''} Found`;

            const trustedCount = jobs.filter(job => job.is_trusted_company).length;
            const categories = [...new Set(jobs.map(job => job.category).filter(c => c))].length;
            resultsMeta.textContent = `${trustedCount} trusted companies ‚Ä¢ ${categories} categories ‚Ä¢ Updated ${new Date().toLocaleTimeString()}`;

            jobGrid.innerHTML = jobs.map(job => `
                <div class="job-card">
                    <div class="job-header">
                        <h3 class="job-title">${job.title || 'Job Title'}</h3>
                        <div class="job-company">
                            ${job.company || 'Company Name'}
                            ${job.is_trusted_company ? '<span class="trusted-badge">TRUSTED</span>' : ''}
                        </div>
                        <div class="job-location">${job.location || 'Location'}</div>
                    </div>
                    
                    <div class="job-meta">
                        ${job.job_type ? `<span class="job-type ${job.job_type.toLowerCase().replace('-', '')}">${job.job_type}</span>` : ''}
                        ${job.experience_level ? `<span class="job-level">${job.experience_level}</span>` : ''}
                        ${job.category ? `<span class="job-category">${job.category}</span>` : ''}
                    </div>
                    
                    ${job.salary ? `<div class="job-salary">üí∞ ${job.salary}</div>` : ''}
                    
                    ${job.skills && job.skills.length > 0 ? `
                    <div class="job-skills">
                        <h4>Required Skills</h4>
                        <div class="skill-tags">
                            ${job.skills.slice(0, 8).map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${job.description ? `
                    <div class="job-description">
                        <h4>Description</h4>
                        <p>${job.description.substring(0, 200)}${job.description.length > 200 ? '...' : ''}</p>
                    </div>
                    ` : ''}
                    
                    ${job.requirements && job.requirements.length > 0 ? `
                    <div class="job-requirements">
                        <h4>Key Requirements</h4>
                        <ul>
                            ${job.requirements.slice(0, 3).map(req => `<li>${req}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    <div class="job-footer">
                        <span>Posted: ${job.posted_date ? new Date(job.posted_date).toLocaleDateString() : 'Recently'}</span>
                        ${job.job_url ? `<a href="${job.job_url}" target="_blank" style="color: #0077b5; text-decoration: none;">View Job ‚Üí</a>` : ''}
                    </div>
                </div>
            `).join('');

            resultsSection.style.display = 'block';
            noResults.style.display = 'none';
        }

        function displayAnalytics(jobs) {
            const analyticsSection = document.getElementById('analyticsSection');
            const analyticsGrid = document.getElementById('analyticsGrid');

            if (jobs.length === 0) {
                analyticsSection.style.display = 'none';
                return;
            }

            // Calculate analytics
            const totalJobs = jobs.length;
            const trustedCompanies = jobs.filter(job => job.is_trusted_company).length;
            const categories = [...new Set(jobs.map(job => job.category).filter(c => c))];
            const jobTypes = [...new Set(jobs.map(job => job.job_type).filter(t => t))];
            const avgSalary = calculateAverageSalary(jobs);
            const skillsCount = jobs.reduce((acc, job) => acc + (job.skills ? job.skills.length : 0), 0);

            const analytics = [
                { number: totalJobs, label: 'Total Jobs' },
                { number: trustedCompanies, label: 'Trusted Companies' },
                { number: categories.length, label: 'Categories' },
                { number: jobTypes.length, label: 'Job Types' },
                { number: avgSalary, label: 'Avg Salary (K)' },
                { number: Math.round(skillsCount / totalJobs) || 0, label: 'Avg Skills/Job' }
            ];

            analyticsGrid.innerHTML = analytics.map(item => `
                <div class="analytics-card">
                    <div class="analytics-number">${item.number}</div>
                    <div class="analytics-label">${item.label}</div>
                </div>
            `).join('');

            analyticsSection.style.display = 'block';
        }

        function calculateAverageSalary(jobs) {
            const salaries = jobs.map(job => {
                if (!job.salary || job.salary.includes('hour')) return 0;
                const match = job.salary.match(/\$(\d{1,3}(?:,\d{3})*)/);
                return match ? parseInt(match[1].replace(/,/g, '')) : 0;
            }).filter(salary => salary > 0);

            if (salaries.length === 0) return 'N/A';
            const avg = salaries.reduce((a, b) => a + b, 0) / salaries.length;
            return Math.round(avg / 1000);
        }

        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#cce7ff'};
                color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#004085'};
                padding: 15px 20px;
                border-radius: 8px;
                border: 1px solid ${type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : '#b6d7ff'};
                z-index: 1000;
                font-weight: 600;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                max-width: 300px;
            `;

            document.body.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.remove();
            }, 4000);
        }

        function showError(message) {
            const errorSection = document.getElementById('errorSection');
            const errorMessage = document.getElementById('errorMessage');

            errorMessage.textContent = message;
            errorSection.style.display = 'block';

            setTimeout(() => {
                errorSection.style.display = 'none';
            }, 8000);
        }

        function clearData() {
            currentJobsData = [];
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('analyticsSection').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
            showMessage('Results cleared');
        }

        function refreshData() {
            const keywords = document.getElementById('keywords').value.trim();
            const location = document.getElementById('location').value.trim();

            if (!keywords || !location) {
                showError('Please enter search criteria first');
                return;
            }

            const maxJobs = parseInt(document.getElementById('maxJobs').value);
            const jobType = document.getElementById('jobType').value;
            const category = document.getElementById('category').value;
            const trustedOnly = document.getElementById('trustedOnly').value === 'true';

            searchJobs(keywords, location, maxJobs, jobType, category, trustedOnly, true);
        }

        function exportResults(format = 'json') {
            if (currentJobsData.length === 0) {
                showError('No data to export');
                return;
            }

            const timestamp = new Date().toISOString().split('T')[0];

            if (format === 'json') {
                const dataStr = JSON.stringify(currentJobsData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                downloadFile(dataBlob, `linkedin_jobs_${timestamp}.json`);
            } else if (format === 'csv') {
                const csvContent = convertToCSV(currentJobsData);
                const dataBlob = new Blob([csvContent], { type: 'text/csv' });
                downloadFile(dataBlob, `linkedin_jobs_${timestamp}.csv`);
            }

            showMessage(`Data exported successfully (${format.toUpperCase()})`, 'success');
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';

            const headers = ['title', 'company', 'location', 'job_type', 'category', 'salary', 'skills', 'posted_date', 'job_url'];
            const csvRows = [headers.join(',')];

            for (const row of data) {
                const values = headers.map(header => {
                    let val = row[header] || '';
                    if (Array.isArray(val)) val = val.join('; ');
                    if (typeof val === 'string') val = '"' + val.replace(/"/g, '""') + '"';
                    return val;
                });
                csvRows.push(values.join(','));
            }

            return csvRows.join('\n');
        }

        function downloadFile(blob, filename) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Add example searches section
        function addExampleSearches() {
            const exampleSearches = [
                { keywords: 'Python Developer', location: 'San Francisco, CA' },
                { keywords: 'Data Scientist', location: 'New York, NY' },
                { keywords: 'React Developer', location: 'Austin, TX' },
                { keywords: 'DevOps Engineer', location: 'Seattle, WA' },
                { keywords: 'Machine Learning Engineer', location: 'Boston, MA' }
            ];

            const quickSearchDiv = document.createElement('div');
            quickSearchDiv.innerHTML = `
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <label style="font-weight: 600; margin-bottom: 10px; display: block; color: #495057;">Example Searches:</label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        ${exampleSearches.map(search => `
                            <button type="button" class="cache-btn" onclick="quickSearch('${search.keywords}', '${search.location}')" 
                                style="background: #17a2b8; color: white; font-size: 11px; padding: 5px 10px;">
                                ${search.keywords}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            document.querySelector('.search-section').appendChild(quickSearchDiv);
        }

        function quickSearch(keywords, location) {
            document.getElementById('keywords').value = keywords;
            document.getElementById('location').value = location;
            document.getElementById('searchForm').dispatchEvent(new Event('submit'));
        }

        // Initialize example searches
        setTimeout(addExampleSearches, 100);

        // Global function for cache operations
        window.clearCache = clearCache;
        window.getCacheStatus = getCacheStatus;
        window.refreshData = refreshData;
        window.clearData = clearData;
        window.exportResults = exportResults;
        window.quickSearch = quickSearch;
    </script>
</body>

</html>